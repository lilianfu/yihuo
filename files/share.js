;(function( global ){function MaorenShareJsSDK(){
var that = this,appId='',timestamp=0,nonceStr='',signature='';
var removeHTMLTag = function(str){if(!str){return;}str = str.replace(/<\/?[^>]*>/g,'');str = str.replace('<br />','');str = str.replace(/[ | ]*\n/g,'\n');str = str.replace(/\n[\s| | ]*\r/g,'\n'); str = str.replace(/ /ig,'');return str};
var updateSetField = function(param,field){if(!param.updateInfo.url){param.error('更新地址错误');return false};if(!param.updateInfo.id){param.error('更新编号错误');return false};$.ajax({url: param.updateInfo.url,type:'POST',dataType:"json",data:{id:param.updateInfo.id,field:field},success: function(data){param.success(data)},error:function(data){param.error('update_'+field+':setfielderror')}})};
 this.t = function(param){wx.config({debug: false,appId: appId,timestamp: timestamp,nonceStr: nonceStr,signature: signature,jsApiList: ['checkJsApi','onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','onMenuShareQZone'],success: function (res) {},fail: function(res) {},complete: function(res) {}}); 
 wx.ready(function(){var share = function (field){  return  {title: removeHTMLTag(param.title),desc: removeHTMLTag(param.desc),link: param.link,imgUrl: param.imgUrl,trigger: function (res) {},success: function (res) {if(param.isupdateInfo ===true){updateSetField(param,field)} if( typeof param.isupdateInfo === 'function'){param.isupdateInfo(field)}},cancel: function (res) {},fail: function (res) {}}};wx.onMenuShareTimeline(share('shares'));wx.onMenuShareQQ(share('shares'));wx.onMenuShareWeibo(share('shares'));wx.onMenuShareQZone(share('shares'));wx.onMenuShareAppMessage(share('sends'))})}
this.start = function(){var param = {title: arguments[0].title || '分享标题',desc: arguments[0].desc || '分享描述',link: arguments[0].link || 'http://yanghuo.co/',current_url: arguments[0].current_url || '',imgUrl: arguments[0].imgUrl || 'http://yanghuo.co/logo.png',updateInfo: arguments[0].updateInfo || {id:0,url:''},isupdateInfo:arguments[0].isupdateInfo || function() {},success: arguments[0].success || function() {},error: arguments[0].error || function() {}};if(that.is_weixin()==true){that.getJsSign(param)}};
this.is_weixin=function(){if(window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i) == 'micromessenger'){return true;}else{return false}}
this.getJsSign = function(param){$.ajax({url:'/Wxjssign/v1',type:"POST",dataType:"json",data:{url:param.current_url},success: function(res){if(res.status==1){appId = res.data.appId; timestamp = res.data.timestamp; nonceStr = res.data.nonceStr; signature = res.data.signature;that.t(param)}else{param.error('获取签名失败')}},error:function(data){ param.error('获取签名请求失败')}})}}var MaorenShare = new MaorenShareJsSDK();global.MaorenShare = MaorenShare;global.MaorenShareJsSDK = MaorenShareJsSDK})( window );